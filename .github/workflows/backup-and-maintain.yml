name: ğŸ›¡ï¸ Academy Website Backup & Maintenance

on:
  schedule:
    - cron: '0 2 * * 0' # Weekly on Sunday at 2 AM
  workflow_dispatch: # Manual trigger

jobs:
  backup:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ—„ï¸ Create Backup
      run: |
        DATE=$(date +%Y%m%d_%H%M%S)
        mkdir -p backups
        tar -czf backups/panamerican-tkd-backup-$DATE.tar.gz src/ README.md LICENSE
        echo "Backup created: panamerican-tkd-backup-$DATE.tar.gz"
        
    - name: â˜ï¸ Upload to Cloud Storage
      uses: google-github-actions/upload-cloud-storage@v1
      with:
        path: backups/
        destination: panamerican-tkd-backups/
        credentials: ${{ secrets.GCP_SA_KEY }}
        
    - name: ğŸ§¹ Clean Old Backups
      run: |
        # Keep only last 10 backups
        ls -t backups/ | tail -n +11 | xargs -r rm --
        
    - name: ğŸ“Š Generate Backup Report
      run: |
        echo "# ğŸ¥‹ Backup Report - Panamerican Taekwondo Academy" > backup-report.md
        echo "Date: $(date)" >> backup-report.md
        echo "## Files Backed Up:" >> backup-report.md
        find src/ -type f -name "*.html" -o -name "*.js" -o -name "*.css" | wc -l >> backup-report.md
        echo "## Backup Status: âœ… Successful" >> backup-report.md
